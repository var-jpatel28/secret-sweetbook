<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Secret Sweetbook</title>
<style>
  :root{
    --bg:#FFF8FB;
    --card:#FFF;
    --accent:#FF9ACD;
    --muted:#8b6b7b;
    --glass: rgba(255,255,255,0.6);
    font-family: "Segoe UI", Roboto, system-ui, -apple-system, "Helvetica Neue", Arial;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background:linear-gradient(180deg,#FFF8FB 0%, #FFF4F8 60%) fixed;
    color:#4a2a3a;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:20px;
  }
  .frame{
    width:100%;
    max-width:1000px;
    background:var(--glass);
    padding:22px;
    border-radius:18px;
    box-shadow:0 10px 30px rgba(70,20,40,0.12);
    backdrop-filter: blur(6px);
  }
  header{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
    margin-bottom:14px;
  }
  h1{margin:0;font-size:1.4rem;letter-spacing:0.6px}
  .heart{font-size:1.6rem; color:var(--accent); transform:translateY(2px)}
  .small{font-size:0.9rem;color:var(--muted)}
  /* login */
  .center{
    display:grid;
    place-items:center;
    padding:28px 12px;
  }
  .card{
    background:var(--card);
    padding:18px;
    border-radius:14px;
    box-shadow: 0 6px 18px rgba(60,20,40,0.06);
    width:100%;
    max-width:720px;
  }
  label{display:block;font-size:0.9rem;margin-bottom:6px}
  input[type="password"], input[type="file"], textarea{
    width:100%;
    padding:10px 12px;
    border-radius:10px;
    border:1px solid #f0d8e6;
    background:#fff;
    outline:none;
    font-size:1rem;
  }
  .row{display:flex; gap:10px; align-items:center}
  .btn{
    background:var(--accent);
    color:white;
    border:none;
    padding:10px 14px;
    border-radius:10px;
    cursor:pointer;
    font-weight:600;
    box-shadow:0 6px 12px rgba(255,154,205,0.14);
  }
  .ghost{background:transparent;color:var(--accent);border:1px dashed rgba(255,154,205,0.25)}
  .muted{color:var(--muted);font-size:0.9rem}
  /* main UI */
  .toolbar{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
  .layout{display:grid;grid-template-columns:300px 1fr; gap:16px}
  .sidebar{
    background:var(--card);
    padding:12px;border-radius:12px;min-height:360px;overflow:auto;
  }
  .content{
    background:var(--card); padding:16px;border-radius:12px;min-height:360px;overflow:auto;
  }
  .entry{border-radius:10px;padding:10px;margin-bottom:8px;cursor:pointer;border:1px solid transparent}
  .entry:hover{background:linear-gradient(90deg,#fff5fb,#fff8fb);border-color:#fde9f7}
  .entry.active{box-shadow:0 6px 14px rgba(255,154,205,0.08);border:1px solid rgba(255,154,205,0.25)}
  .thumb{height:56px;width:56px;border-radius:8px;object-fit:cover;margin-right:10px}
  .entry-row{display:flex;align-items:center}
  .title{font-weight:700}
  .date{font-size:0.8rem;color:var(--muted)}
  .editor{display:grid;grid-template-rows:auto auto 1fr; gap:10px}
  .images{display:flex;gap:8px;flex-wrap:wrap}
  .images img{height:100px;border-radius:8px;object-fit:cover}
  .drop{border:2px dashed rgba(255,154,205,0.18);padding:12px;border-radius:8px;text-align:center;color:var(--muted)}
  .controls{display:flex;gap:8px;flex-wrap:wrap}
  .note{font-size:0.9rem}
  footer{margin-top:12px;display:flex;justify-content:space-between;align-items:center}
  .small-muted{font-size:0.85rem;color:var(--muted)}
  @media (max-width:840px){
    .layout{grid-template-columns:1fr;max-height:70vh;overflow:auto}
    .sidebar{order:2}
    .content{order:1}
  }
</style>
</head>
<body>
  <div class="frame">
    <header>
      <div>
        <h1>Secret Sweetbook <span class="heart">♥</span></h1>
        <div class="small">A tiny password-locked place for photos & letters</div>
      </div>
      <div>
        <div class="small-muted" id="statusText">locked</div>
      </div>
    </header>

    <div id="loginView" class="center card">
      <div style="width:100%;max-width:540px">
        <div id="firstTimeNote" class="muted" style="margin-bottom:10px">Create a password to open your Secret Sweetbook on this device.</div>
        <label for="pwdInput">Password</label>
        <input id="pwdInput" type="password" placeholder="Your secret password"/>
        <div style="height:10px"></div>
        <div class="row" style="justify-content:flex-end">
          <button id="loginBtn" class="btn">Save & Open</button>
        </div>
        <div style="height:10px"></div>
        <div class="muted">This prototype stores everything locally in your browser. Not secure if others can access your device.</div>
      </div>
    </div>

    <div id="appView" style="display:none">
      <div class="toolbar">
        <button id="newEntryBtn" class="btn">+ New Letter</button>
        <button id="exportBtn" class="ghost">Export</button>
        <button id="importBtn" class="ghost">Import</button>
        <button id="changePwdBtn" class="ghost">Change Password</button>
      </div>

      <div class="layout">
        <aside class="sidebar">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <div class="small-muted">Your entries</div>
            <div class="small-muted" id="countEntries">0</div>
          </div>
          <div id="entriesList"></div>
        </aside>

        <main class="content">
          <div class="editor">
            <input id="titleInput" placeholder="Title (e.g., 'A rainy night')" style="padding:10px;border-radius:8px;border:1px solid #f0d8e6"/>
            <div style="display:flex;gap:8px;align-items:center">
              <div id="dropZone" class="drop" style="flex:1">Drop images here or <label style="color:var(--accent);cursor:pointer"><input id="fileInput" type="file" accept="image/*" multiple style="display:none">choose photos</label></div>
              <div style="display:flex;flex-direction:column;gap:8px">
                <button id="saveBtn" class="btn">Save</button>
                <button id="deleteBtn" class="ghost">Delete</button>
              </div>
            </div>

            <div contenteditable="true" id="contentEditor" style="padding:12px;border-radius:10px;border:1px solid #f0d8e6;min-height:180px;outline:none">
              Write your letter here... you can format a little by using enter/shift+enter.
            </div>
          </div>

          <div style="margin-top:12px">
            <div class="small-muted">Attached photos</div>
            <div id="imagesContainer" class="images" style="margin-top:8px"></div>
          </div>

          <footer>
            <div class="small-muted">Tip: Export to save a backup file.</div>
            <div class="small-muted">Local only • Prototype</div>
          </footer>
        </main>
      </div>
    </div>

  </div>

<script>
/*
Simple client-side "password" and localStorage-backed notebook.
Not secure for sensitive data. For demo/personal local use only.
*/

const STORAGE_KEY = 'sweetbook_data_v1';
const PWD_KEY = 'sweetbook_pwd_v1';
const STATUS = document.getElementById('statusText');

let state = {
  entries: [], // {id, title, contentHtml, images: [dataUrl], createdAt}
  unlocked: false,
  currentId: null
};

// helpers
function uid(){ return 'id-' + Math.random().toString(36).slice(2,11) }
function saveAll(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state.entries)) }
function loadAll(){
  const raw = localStorage.getItem(STORAGE_KEY);
  state.entries = raw ? JSON.parse(raw) : [];
}
function setPwd(pwd){ localStorage.setItem(PWD_KEY, btoa(pwd)) } // simple obfuscation only
function checkPwd(pwd){
  const stored = localStorage.getItem(PWD_KEY);
  if(!stored) return null;
  try{ return atob(stored) === pwd } catch(e){ return false }
}
function hasPwd(){ return !!localStorage.getItem(PWD_KEY) }

function updateEntriesList(){
  const el = document.getElementById('entriesList');
  el.innerHTML = '';
  state.entries.sort((a,b)=> b.createdAt - a.createdAt);
  state.entries.forEach(ent=>{
    const div = document.createElement('div');
    div.className = 'entry' + (state.currentId === ent.id ? ' active' : '');
    div.dataset.id = ent.id;
    const inner = document.createElement('div');
    inner.className='entry-row';
    const img = document.createElement('img');
    img.className='thumb';
    img.src = ent.images && ent.images[0] ? ent.images[0] : placeholderDataUrl();
    const meta = document.createElement('div');
    const t = document.createElement('div'); t.className='title'; t.textContent = ent.title || '(Untitled)';
    const d = document.createElement('div'); d.className='date'; d.textContent = new Date(ent.createdAt).toLocaleString();
    meta.appendChild(t); meta.appendChild(d);
    inner.appendChild(img); inner.appendChild(meta);
    div.appendChild(inner);
    div.addEventListener('click', ()=> openEntry(ent.id));
    el.appendChild(div);
  });
  document.getElementById('countEntries').textContent = state.entries.length;
}

function placeholderDataUrl(){
  // simple SVG placeholder
  const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='400' height='300'><rect width='100%' height='100%' fill='#fff0f6'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='#eaa1c9' font-size='20'>photo</text></svg>`;
  return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
}

function openEntry(id){
  const ent = state.entries.find(e=>e.id===id);
  if(!ent) return;
  state.currentId = id;
  document.getElementById('titleInput').value = ent.title || '';
  document.getElementById('contentEditor').innerHTML = ent.contentHtml || '';
  renderImages(ent.images || []);
  updateEntriesList();
}

function renderImages(arr){
  const c = document.getElementById('imagesContainer');
  c.innerHTML = '';
  (arr||[]).forEach((d,i)=>{
    const img = document.createElement('img');
    img.src = d;
    img.title = 'Click to remove';
    img.style.cursor = 'pointer';
    img.addEventListener('click', ()=> {
      if(!confirm('Remove this photo?')) return;
      const ent = state.entries.find(e=>e.id===state.currentId);
      if(!ent) return;
      ent.images.splice(i,1);
      saveAll();
      renderImages(ent.images);
      updateEntriesList();
    });
    c.appendChild(img);
  });
}

function newEntry(){
  const ent = { id: uid(), title:'', contentHtml:'', images:[], createdAt: Date.now() };
  state.entries.push(ent);
  saveAll();
  openEntry(ent.id);
}

function saveCurrent(){
  if(!state.currentId) { alert('No entry selected. Create one with "New Letter".'); return; }
  const ent = state.entries.find(e=>e.id===state.currentId);
  ent.title = document.getElementById('titleInput').value.trim();
  ent.contentHtml = document.getElementById('contentEditor').innerHTML;
  ent.updatedAt = Date.now();
  saveAll();
  updateEntriesList();
  alert('Saved!');
}

function deleteCurrent(){
  if(!state.currentId) return;
  if(!confirm('Delete this entry? This cannot be undone.')) return;
  state.entries = state.entries.filter(e=>e.id !== state.currentId);
  state.currentId = null;
  saveAll();
  updateEntriesList();
  clearEditor();
}

function clearEditor(){
  document.getElementById('titleInput').value = '';
  document.getElementById('contentEditor').innerHTML = '';
  document.getElementById('imagesContainer').innerHTML = '';
}

function attachFiles(files){
  if(!files || files.length===0) return;
  const ent = state.currentId ? state.entries.find(e=>e.id===state.currentId) : null;
  if(!ent){
    // create a new entry automatically
    const newId = uid();
    const newEnt = {id:newId, title:'', contentHtml:'', images:[], createdAt: Date.now()};
    state.entries.push(newEnt);
    state.currentId = newId;
  }
  const target = state.entries.find(e=>e.id===state.currentId);
  Array.from(files).forEach(f=>{
    const reader = new FileReader();
    reader.onload = function(ev){
      target.images.push(ev.target.result);
      saveAll();
      renderImages(target.images);
      updateEntriesList();
    };
    reader.readAsDataURL(f);
  });
}

// drag/drop
const dropZone = document.getElementById('dropZone');
dropZone.addEventListener('dragover', (e)=>{ e.preventDefault(); dropZone.style.borderColor = 'rgba(255,154,205,0.6)';});
dropZone.addEventListener('dragleave', ()=> dropZone.style.borderColor = 'rgba(255,154,205,0.18)');
dropZone.addEventListener('drop', (e)=>{
  e.preventDefault();
  dropZone.style.borderColor = 'rgba(255,154,205,0.18)';
  attachFiles(e.dataTransfer.files);
});

// wiring UI
document.getElementById('fileInput').addEventListener('change', (e)=> attachFiles(e.target.files));
document.getElementById('newEntryBtn').addEventListener('click', ()=> { newEntry(); updateEntriesList(); });
document.getElementById('saveBtn').addEventListener('click', ()=> saveCurrent());
document.getElementById('deleteBtn').addEventListener('click', ()=> deleteCurrent());

document.getElementById('exportBtn').addEventListener('click', ()=>{
  const data = { entries: state.entries, exportedAt: Date.now() };
  const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'sweetbook_backup_' + (new Date()).toISOString().slice(0,10) + '.json';
  a.click();
  URL.revokeObjectURL(url);
});

document.getElementById('importBtn').addEventListener('click', ()=>{
  const inpt = document.createElement('input');
  inpt.type = 'file';
  inpt.accept = '.json,application/json';
  inpt.addEventListener('change', e=>{
    const f = e.target.files[0];
    if(!f) return;
    const r = new FileReader();
    r.onload = ev => {
      try{
        const data = JSON.parse(ev.target.result);
        if(!Array.isArray(data.entries)) throw new Error('Invalid file');
        // merge: append imported entries with new ids to avoid collisions
        data.entries.forEach(ent=>{
          const copy = {...ent, id: uid()};
          state.entries.push(copy);
        });
        saveAll();
        updateEntriesList();
        alert('Imported ' + data.entries.length + ' entries.');
      }catch(err){ alert('Import failed: ' + err.message) }
    };
    r.readAsText(f);
  });
  inpt.click();
});

// password flows
const loginView = document.getElementById('loginView');
const appView = document.getElementById('appView');
const pwdInput = document.getElementById('pwdInput');
const loginBtn = document.getElementById('loginBtn');
const firstNote = document.getElementById('firstTimeNote');

function showLocked(){
  loginView.style.display='grid'; appView.style.display='none';
  STATUS.textContent = 'locked';
  firstNote.style.display = hasPwd() ? 'none' : 'block';
  pwdInput.value = '';
}

function unlockAndOpen(){
  loadAll();
  loginView.style.display='none'; appView.style.display='block';
  STATUS.textContent = 'open';
  updateEntriesList();
  // open most recent entry if exists
  if(state.entries.length>0) openEntry(state.entries[0].id);
}

loginBtn.addEventListener('click', ()=>{
  const val = pwdInput.value || '';
  if(!hasPwd()){
    if(val.length < 4){ alert('Choose a password of at least 4 characters for this demo.'); return; }
    setPwd(val);
    alert('Password set — keep it safe on this device.');
    unlockAndOpen();
  } else {
    if(checkPwd(val)){
      unlockAndOpen();
    } else {
      alert('Incorrect password.');
    }
  }
});

// change password
document.getElementById('changePwdBtn').addEventListener('click', ()=>{
  const cur = prompt('Enter your current password:');
  if(cur === null) return;
  if(!checkPwd(cur)){ alert('Wrong current password'); return; }
  const nw = prompt('Enter new password (at least 4 chars):');
  if(!nw || nw.length < 4) { alert('Aborted — password too short.'); return; }
  setPwd(nw);
  alert('Password changed.');
});

// check initial state
(function init(){
  if(!hasPwd()){
    showLocked();
  } else {
    showLocked(); // still ask for password
  }
})();

// load data when unlocked
loadAll();

</script>
</body>
</html>
